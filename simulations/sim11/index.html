<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „êµ¬ ì—ë„ˆì§€ íš¨ìœ¨ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .energy-diagram {
            text-align: center;
            padding: 20px 0;
            position: relative;
        }

        .bulb {
            font-size: 80px;
            margin: 20px 0;
            transition: all 0.5s ease;
        }

        .bulb.dim {
            animation: glowDim 2s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.3));
            opacity: 0.6;
        }

        .bulb.medium {
            animation: glowMedium 2s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.7));
            opacity: 0.85;
        }

        .bulb.bright {
            animation: glowBright 2s ease-in-out infinite;
            filter: drop-shadow(0 0 35px rgba(255, 215, 0, 1));
            opacity: 1;
        }

        @keyframes glowDim {
            0%, 100% { 
                filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.3));
            }
            50% { 
                filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.4));
            }
        }

        @keyframes glowMedium {
            0%, 100% { 
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.7));
            }
            50% { 
                filter: drop-shadow(0 0 25px rgba(255, 215, 0, 0.85));
            }
        }

        @keyframes glowBright {
            0%, 100% { 
                filter: drop-shadow(0 0 35px rgba(255, 215, 0, 1));
            }
            50% { 
                filter: drop-shadow(0 0 45px rgba(255, 215, 0, 1.3));
            }
        }

        .energy-flow {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .energy-box {
            flex: 1;
            margin: 0 10px;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .input-energy {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-weight: bold;
        }

        .light-energy {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            font-weight: bold;
        }

        .heat-energy {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            font-weight: bold;
        }

        .energy-label {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .energy-value {
            font-size: 24px;
            font-weight: bold;
        }

        .problem-section {
            margin: 20px 0;
            line-height: 1.8;
        }

        .problem-text {
            font-size: 16px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-new {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-check {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-badge {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #333;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            animation: slideIn 0.5s ease-out;
            font-size: 15px;
            line-height: 1.8;
        }

        .result.correct {
            background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%);
            color: white;
        }

        .result.incorrect {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: #d32f2f;
        }

        .celebration {
            font-size: 40px;
            text-align: center;
            margin: 10px 0;
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .badge-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }

        .badge-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .badge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .badge-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
        }

        .badge-item.earned {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            box-shadow: 0 4px 10px rgba(253, 203, 110, 0.4);
        }

        .badge-item.locked {
            opacity: 0.4;
        }

        .badge-tooltip {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            white-space: nowrap;
            margin-bottom: 5px;
            z-index: 10;
        }

        .badge-item:hover .badge-tooltip {
            display: block;
        }

        .badge-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #333;
        }

        .badge-icon {
            font-size: 40px;
            margin-bottom: 5px;
        }

        .badge-name {
            font-size: 12px;
            font-weight: bold;
        }

        .close-modal {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }

        .badge-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            z-index: 2000;
            text-align: center;
            animation: badgePopup 2s ease-out forwards;
        }

        @keyframes badgePopup {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
                opacity: 1;
            }
            70% {
                transform: translate(-50%, -50%) scale(0.9) rotate(-5deg);
            }
            85% {
                transform: translate(-50%, -50%) scale(1.05) rotate(2deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .badge-notification-icon {
            font-size: 80px;
            animation: iconBounce 0.6s ease-out 0.5s;
        }

        @keyframes iconBounce {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-20px); }
            50% { transform: translateY(-10px); }
            75% { transform: translateY(-5px); }
        }

        .badge-notification-title {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin: 15px 0 10px 0;
        }

        .badge-notification-desc {
            font-size: 16px;
            color: #666;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 1999;
            pointer-events: none;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’¡ ì „êµ¬ ì—ë„ˆì§€ íš¨ìœ¨ ì‹œë®¬ë ˆì´ì…˜</h1>
            <p>ì—ë„ˆì§€ ë³€í™˜ê³¼ íš¨ìœ¨ì„ ê³„ì‚°í•´ë³´ì„¸ìš”!</p>
        </div>

        <div class="card">
            <div class="energy-diagram">
                <div class="input-energy" style="display: inline-block; padding: 10px 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div class="energy-label">íˆ¬ì… ì—ë„ˆì§€</div>
                    <div class="energy-value" id="inputEnergy">60 J</div>
                </div>

                <div>â¬‡ï¸</div>

                <div class="bulb" id="bulb">ğŸ’¡</div>

                <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 15px;">
                    <div>â¬‡ï¸</div>
                    <div>â¬‡ï¸</div>
                </div>

                <div class="energy-flow">
                    <div class="energy-box light-energy">
                        <div class="energy-label">ì „ê¸° ì—ë„ˆì§€(ë¹›)</div>
                        <div class="energy-value" id="lightEnergy">15 J</div>
                    </div>
                    <div class="energy-box heat-energy">
                        <div class="energy-label">ì—´ ì—ë„ˆì§€</div>
                        <div class="energy-value" id="heatEnergy">? J</div>
                    </div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">ì •ë‹µ ìˆ˜</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">ì´ ë¬¸ì œ ìˆ˜</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracy">-</div>
                    <div class="stat-label">ì •ë‹µë¥ </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="problem-section">
                <div class="problem-text" id="problemText">
                    ê·¸ë¦¼ì€ ì™¸ë¶€ë¡œë¶€í„° 60 Jì˜ ì¼(ì—ë„ˆì§€)ì„ ë°›ëŠ” ì „êµ¬ë¥¼ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤. ì „êµ¬ê°€ ë°œìƒí•œ ì—´ì´ ëª‡ Jì¸ì§€ êµ¬í•˜ì‹œì˜¤.
                </div>

                <div class="input-group">
                    <label for="heatAnswer">(1) ë°œìƒí•œ ì—´ Q (J)</label>
                    <input type="number" id="heatAnswer" placeholder="ì—´ì—ë„ˆì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="input-group">
                    <label for="efficiencyAnswer">(2) ì „êµ¬ì˜ ì—ë„ˆì§€ íš¨ìœ¨ (%)</label>
                    <input type="number" id="efficiencyAnswer" placeholder="íš¨ìœ¨ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="button-group">
                    <button class="btn-new" onclick="generateNewProblem()">ğŸ”„ ìƒˆë¬¸ì œ</button>
                    <button class="btn-check" onclick="checkAnswer()">âœ“ ë‹µ í™•ì¸</button>
                    <button class="btn-badge" onclick="showBadges()">ğŸ† ë±ƒì§€</button>
                </div>

                <div id="result"></div>
            </div>
        </div>
    </div>

    <div class="badge-modal" id="badgeModal">
        <div class="badge-content">
            <h2 style="text-align: center; margin-bottom: 10px;">ğŸ† ë±ƒì§€ ë„ê°</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">íšë“í•œ ë±ƒì§€: <span id="earnedBadges">0</span> / 14</p>
            <div class="badge-grid" id="badgeGrid"></div>
            <button class="close-modal" onclick="closeBadges()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        let currentProblem = {};
        let stats = {
            correct: 0,
            total: 0,
            badges: []
        };
        let isAnswered = false; // í˜„ì¬ ë¬¸ì œì˜ ë‹µë³€ ì—¬ë¶€ ì¶”ì 

        const badges = [
            { id: 'first', icon: 'ğŸŒŸ', name: 'ì²« ë„ì „', condition: () => stats.total >= 1, desc: 'ì²« ë¬¸ì œ í’€ê¸°' },
            { id: 'beginner', icon: 'âœ¨', name: 'ì´ˆë³´ ê³¼í•™ì', condition: () => stats.correct >= 3, desc: '3ë¬¸ì œ ì •ë‹µ' },
            { id: 'intermediate', icon: 'ğŸ”¬', name: 'ì¤‘ê¸‰ ê³¼í•™ì', condition: () => stats.correct >= 5, desc: '5ë¬¸ì œ ì •ë‹µ' },
            { id: 'advanced', icon: 'ğŸ§ª', name: 'ê³ ê¸‰ ê³¼í•™ì', condition: () => stats.correct >= 8, desc: '8ë¬¸ì œ ì •ë‹µ' },
            { id: 'expert', icon: 'ğŸ“', name: 'ì—ë„ˆì§€ ì „ë¬¸ê°€', condition: () => stats.correct >= 10, desc: '10ë¬¸ì œ ì •ë‹µ' },
            { id: 'perfect', icon: 'ğŸ’¯', name: 'ì™„ë²½ì£¼ì˜ì', condition: () => stats.correct >= 5 && stats.correct === stats.total, desc: '5ë¬¸ì œ ì—°ì† ì •ë‹µ' },
            { id: 'persistent', icon: 'ğŸ’ª', name: 'ëˆê¸°ì˜ ë‹¬ì¸', condition: () => stats.total >= 10, desc: '10ë¬¸ì œ ë„ì „' },
            { id: 'marathon', icon: 'ğŸƒ', name: 'ë§ˆë¼í† ë„ˆ', condition: () => stats.total >= 20, desc: '20ë¬¸ì œ ë„ì „' },
            { id: 'speedster', icon: 'âš¡', name: 'ë²ˆê°œ ê³„ì‚°', condition: () => stats.correct >= 3, desc: '3ë¬¸ì œ ì •ë‹µ' },
            { id: 'ace', icon: 'ğŸ†', name: 'ì—ì´ìŠ¤', condition: () => stats.correct >= 15, desc: '15ë¬¸ì œ ì •ë‹µ' },
            { id: 'master', icon: 'ğŸ‘‘', name: 'ì—ë„ˆì§€ ë§ˆìŠ¤í„°', condition: () => stats.correct >= 20, desc: '20ë¬¸ì œ ì •ë‹µ' },
            { id: 'legend', icon: 'ğŸŒ ', name: 'ì „ì„¤', condition: () => stats.correct >= 30, desc: '30ë¬¸ì œ ì •ë‹µ' },
            { id: 'accuracy', icon: 'ğŸ¯', name: 'ì •í™•ë„ í‚¹', condition: () => stats.total >= 10 && (stats.correct / stats.total) >= 0.9, desc: '90% ì´ìƒ ì •ë‹µë¥ ' },
            { id: 'perfect100', icon: 'ğŸ’', name: 'ì™„ë²½í•œ ê¸°ë¡', condition: () => stats.total >= 10 && stats.correct === stats.total, desc: '10ë¬¸ì œ ì „ë¶€ ì •ë‹µ' }
        ];

        // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();

        function playSound(type) {
            if (type === 'correct') {
                // ë°ê³  ê²½ì¾Œí•œ 3í™”ìŒ ë©œë¡œë””
                const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                notes.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
                    gain.gain.setValueAtTime(0.15, audioContext.currentTime + i * 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
                    
                    osc.start(audioContext.currentTime + i * 0.1);
                    osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
                });
            } else if (type === 'incorrect') {
                // ë‚®ì€ í†¤ì˜ ëšœ-
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.frequency.setValueAtTime(200, audioContext.currentTime);
                gain.gain.setValueAtTime(0.3, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + 0.3);
            } else if (type === 'new') {
                // ê¹¨ë—í•œ ì „ì íš¨ê³¼ìŒ (ìƒìŠ¹)
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, audioContext.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.15);
                gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                
                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + 0.15);
            }
        }

        function generateNewProblem() {
            playSound('new');
            
            // ìƒˆ ë¬¸ì œ ìƒì„± ì‹œ ë‹µë³€ ì—¬ë¶€ ì´ˆê¸°í™”
            isAnswered = false;
            
            // íš¨ìœ¨ì„ ë¨¼ì € ì„ íƒ (15, 20, 25, 30, 35, 40, 45, 50, 55, 60)
            const efficiencies = [15, 20, 25, 30, 35, 40, 45, 50, 55, 60];
            const efficiency = efficiencies[Math.floor(Math.random() * efficiencies.length)];
            
            // Q0ë¥¼ ì„ íƒ (20~100, 5ì˜ ë°°ìˆ˜ì´ë©° Wë„ 5ì˜ ë°°ìˆ˜ê°€ ë˜ë„ë¡)
            let Q0, W;
            do {
                Q0 = (Math.floor(Math.random() * 17) + 4) * 5; // 20~100
                W = Q0 * efficiency / 100;
            } while (W % 5 !== 0);
            
            const Q = Q0 - W;
            
            currentProblem = {
                Q0: Q0,
                W: W,
                Q: Q,
                efficiency: efficiency
            };
            
            // ì „êµ¬ ë°ê¸° ì„¤ì • (3ë‹¨ê³„)
            const bulb = document.getElementById('bulb');
            if (efficiency <= 30) {
                bulb.className = 'bulb dim';
            } else if (efficiency <= 45) {
                bulb.className = 'bulb medium';
            } else {
                bulb.className = 'bulb bright';
            }
            
            document.getElementById('inputEnergy').textContent = `${Q0} J`;
            document.getElementById('lightEnergy').textContent = `${W} J`;
            document.getElementById('heatEnergy').textContent = `? J`;
            document.getElementById('problemText').textContent = 
                `ê·¸ë¦¼ì€ ì™¸ë¶€ë¡œë¶€í„° ${Q0} Jì˜ ì¼(ì—ë„ˆì§€)ì„ ë°›ëŠ” ì „êµ¬ë¥¼ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤. ì „êµ¬ê°€ ë°œìƒí•œ ì—´ì´ ëª‡ Jì¸ì§€ êµ¬í•˜ì‹œì˜¤.`;
            
            document.getElementById('heatAnswer').value = '';
            document.getElementById('efficiencyAnswer').value = '';
            document.getElementById('result').innerHTML = '';
        }

        function checkAnswer() {
            const heatAnswer = parseInt(document.getElementById('heatAnswer').value);
            const efficiencyAnswer = parseInt(document.getElementById('efficiencyAnswer').value);
            
            if (isNaN(heatAnswer) || isNaN(efficiencyAnswer)) {
                alert('ëª¨ë“  ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            // ì´ë¯¸ ë‹µë³€í•œ ë¬¸ì œì¸ ê²½ìš° í†µê³„ì— ë°˜ì˜í•˜ì§€ ì•ŠìŒ
            if (isAnswered) {
                alert('ì´ë¯¸ í™•ì¸í•œ ë¬¸ì œì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”!');
                return;
            }
            
            // ë‹µë³€ ì™„ë£Œ í‘œì‹œ
            isAnswered = true;
            stats.total++;
            
            const heatCorrect = heatAnswer === currentProblem.Q;
            const efficiencyCorrect = efficiencyAnswer === currentProblem.efficiency;
            
            const resultDiv = document.getElementById('result');
            
            if (heatCorrect && efficiencyCorrect) {
                stats.correct++;
                playSound('correct');
                resultDiv.className = 'result correct';
                resultDiv.innerHTML = `
                    <div class="celebration">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</div>
                    <p><strong>âœ“ (1) ë°œìƒí•œ ì—´:</strong> ${currentProblem.Q} J</p>
                    <p><strong>âœ“ (2) ì—ë„ˆì§€ íš¨ìœ¨:</strong> ${currentProblem.efficiency}%</p>
                    <hr style="margin: 15px 0; border: none; border-top: 1px solid rgba(255,255,255,0.3);">
                    <p><strong>ğŸ“ í•´ì„¤:</strong></p>
                    <p><strong>(1) ë°œìƒí•œ ì—´ ì—ë„ˆì§€ êµ¬í•˜ê¸°</strong></p>
                    <p>â€¢ ì—ë„ˆì§€ ë³´ì¡´ ë²•ì¹™ì— ì˜í•´ íˆ¬ì…ëœ ì´ ì—ë„ˆì§€ëŠ” ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœ ì „ê¸° ì—ë„ˆì§€(ë¹›)ì™€ ì†ì‹¤ëœ ì—´ ì—ë„ˆì§€ì˜ í•©ê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
                    <p>â€¢ ì´ ì—ë„ˆì§€ = ë¹› ì—ë„ˆì§€ + ì—´ ì—ë„ˆì§€</p>
                    <p>â€¢ ë”°ë¼ì„œ, ì—´ ì—ë„ˆì§€ = ì´ ì—ë„ˆì§€ - ë¹› ì—ë„ˆì§€</p>
                    <p>â€¢ ì—´ ì—ë„ˆì§€ = ${currentProblem.Q0} J - ${currentProblem.W} J = <strong>${currentProblem.Q} J</strong></p>
                    <p style="margin-top: 10px;"><strong>(2) ì—ë„ˆì§€ íš¨ìœ¨ êµ¬í•˜ê¸°</strong></p>
                    <p>â€¢ ì—ë„ˆì§€ íš¨ìœ¨ì€ íˆ¬ì…ëœ ì—ë„ˆì§€ ì¤‘ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœ ì—ë„ˆì§€ì˜ ë¹„ìœ¨ì„ ë°±ë¶„ìœ¨ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒì…ë‹ˆë‹¤.</p>
                    <p>â€¢ ì—ë„ˆì§€ íš¨ìœ¨(%) = (ìœ ìš©í•œ ì—ë„ˆì§€ Ã· íˆ¬ì…ëœ ì—ë„ˆì§€) Ã— 100</p>
                    <p>â€¢ ì—ë„ˆì§€ íš¨ìœ¨ = (${currentProblem.W} J Ã· ${currentProblem.Q0} J) Ã— 100 = <strong>${currentProblem.efficiency}%</strong></p>
                    <p style="margin-top: 10px; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">ğŸ’¡ <strong>í•µì‹¬ ê°œë…:</strong> ì „êµ¬ì˜ íš¨ìœ¨ì´ ${currentProblem.efficiency}%ë¼ëŠ” ê²ƒì€ íˆ¬ì…ëœ ì—ë„ˆì§€ì˜ ${currentProblem.efficiency}%ë§Œ ë¹›ìœ¼ë¡œ ì „í™˜ë˜ê³ , ë‚˜ë¨¸ì§€ ${100-currentProblem.efficiency}%ëŠ” ì—´ë¡œ ì†ì‹¤ë¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
                `;
                checkBadges();
            } else {
                playSound('incorrect');
                resultDiv.className = 'result incorrect';
                resultDiv.innerHTML = `
                    <div style="text-align: center; font-size: 30px;">ğŸ˜¢</div>
                    <p><strong>${heatCorrect ? 'âœ“' : 'âœ—'} (1) ë°œìƒí•œ ì—´:</strong> ì •ë‹µì€ ${currentProblem.Q} Jì…ë‹ˆë‹¤</p>
                    <p><strong>${efficiencyCorrect ? 'âœ“' : 'âœ—'} (2) ì—ë„ˆì§€ íš¨ìœ¨:</strong> ì •ë‹µì€ ${currentProblem.efficiency}%ì…ë‹ˆë‹¤</p>
                    <hr style="margin: 15px 0; border: none; border-top: 1px solid rgba(211, 47, 47, 0.3);">
                    <p><strong>ğŸ“ í•´ì„¤:</strong></p>
                    <p><strong>(1) ë°œìƒí•œ ì—´ ì—ë„ˆì§€ êµ¬í•˜ê¸°</strong></p>
                    <p>â€¢ ì—ë„ˆì§€ ë³´ì¡´ ë²•ì¹™ì— ì˜í•´ íˆ¬ì…ëœ ì´ ì—ë„ˆì§€ëŠ” ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœ ì „ê¸° ì—ë„ˆì§€(ë¹›)ì™€ ì†ì‹¤ëœ ì—´ ì—ë„ˆì§€ì˜ í•©ê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
                    <p>â€¢ ì´ ì—ë„ˆì§€ = ë¹› ì—ë„ˆì§€ + ì—´ ì—ë„ˆì§€</p>
                    <p>â€¢ ë”°ë¼ì„œ, ì—´ ì—ë„ˆì§€ = ì´ ì—ë„ˆì§€ - ë¹› ì—ë„ˆì§€</p>
                    <p>â€¢ ì—´ ì—ë„ˆì§€ = ${currentProblem.Q0} J - ${currentProblem.W} J = <strong>${currentProblem.Q} J</strong></p>
                    <p style="margin-top: 10px;"><strong>(2) ì—ë„ˆì§€ íš¨ìœ¨ êµ¬í•˜ê¸°</strong></p>
                    <p>â€¢ ì—ë„ˆì§€ íš¨ìœ¨ì€ íˆ¬ì…ëœ ì—ë„ˆì§€ ì¤‘ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœ ì—ë„ˆì§€ì˜ ë¹„ìœ¨ì„ ë°±ë¶„ìœ¨ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒì…ë‹ˆë‹¤.</p>
                    <p>â€¢ ì—ë„ˆì§€ íš¨ìœ¨(%) = (ìœ ìš©í•œ ì—ë„ˆì§€ Ã· íˆ¬ì…ëœ ì—ë„ˆì§€) Ã— 100</p>
                    <p>â€¢ ì—ë„ˆì§€ íš¨ìœ¨ = (${currentProblem.W} J Ã· ${currentProblem.Q0} J) Ã— 100 = <strong>${currentProblem.efficiency}%</strong></p>
                    <p style="margin-top: 10px; background: rgba(211, 47, 47, 0.1); padding: 10px; border-radius: 8px; color: #d32f2f;">ğŸ’¡ <strong>ì£¼ì˜:</strong> íš¨ìœ¨ì„ ê³„ì‚°í•  ë•ŒëŠ” (ìœ ìš©í•œ ì—ë„ˆì§€ Ã· íˆ¬ì…ëœ ì—ë„ˆì§€) Ã— 100ì„ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤. ì—´ ì—ë„ˆì§€ëŠ” ì†ì‹¤ëœ ì—ë„ˆì§€ì´ë¯€ë¡œ íš¨ìœ¨ ê³„ì‚°ì— ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!</p>
                `;
            }
            
            document.getElementById('heatEnergy').textContent = `${currentProblem.Q} J`;
            updateStats();
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = stats.correct;
            document.getElementById('totalCount').textContent = stats.total;
            
            if (stats.total > 0) {
                const accuracy = Math.round((stats.correct / stats.total) * 100);
                document.getElementById('accuracy').textContent = accuracy + '%';
            } else {
                document.getElementById('accuracy').textContent = '-';
            }
        }

        function checkBadges() {
            const previousBadges = [...stats.badges];
            const newBadges = [];
            
            badges.forEach(badge => {
                if (!stats.badges.includes(badge.id) && badge.condition()) {
                    stats.badges.push(badge.id);
                    newBadges.push(badge);
                }
            });
            
            if (newBadges.length > 0) {
                // ê° ìƒˆ ë±ƒì§€ë§ˆë‹¤ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
                newBadges.forEach((badge, index) => {
                    setTimeout(() => {
                        showBadgeAnimation(badge);
                    }, index * 2500); // ê° ë±ƒì§€ë§ˆë‹¤ 2.5ì´ˆ ê°„ê²©
                });
            }
        }

        function showBadgeAnimation(badge) {
            // ë°°ê²½ ìƒ‰ì¢…ì´ íš¨ê³¼
            createConfetti();
            
            // ë±ƒì§€ ì•Œë¦¼ ìƒì„±
            const notification = document.createElement('div');
            notification.className = 'badge-notification';
            notification.innerHTML = `
                <div class="badge-notification-icon">${badge.icon}</div>
                <div class="badge-notification-title">ğŸŠ ìƒˆë¡œìš´ ë±ƒì§€ íšë“! ğŸŠ</div>
                <div class="badge-notification-desc"><strong>${badge.name}</strong></div>
                <div class="badge-notification-desc" style="margin-top: 10px; color: #999;">${badge.desc}</div>
            `;
            
            document.body.appendChild(notification);
            
            // ì¶•í•˜ ì†Œë¦¬
            playBadgeSound();
            
            // 2ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                notification.style.animation = 'badgePopup 0.3s ease-in reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#fdcb6e', '#fd79a8', '#a29bfe'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confettiFall ${2 + Math.random() * 2}s linear forwards`;
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    document.body.removeChild(confetti);
                }, 4500);
            }
        }

        function playBadgeSound() {
            // í™”ë ¤í•œ ìƒìŠ¹ ë©œë¡œë””
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            notes.forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.15);
                gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.15);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.4);
                
                osc.start(audioContext.currentTime + i * 0.15);
                osc.stop(audioContext.currentTime + i * 0.15 + 0.4);
            });
        }

        function showBadges() {
            const modal = document.getElementById('badgeModal');
            const grid = document.getElementById('badgeGrid');
            
            grid.innerHTML = badges.map(badge => {
                const earned = stats.badges.includes(badge.id);
                return `
                    <div class="badge-item ${earned ? 'earned' : 'locked'}">
                        <div class="badge-tooltip">${badge.desc}</div>
                        <div class="badge-icon">${earned ? badge.icon : 'ğŸ”’'}</div>
                        <div class="badge-name">${badge.name}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('earnedBadges').textContent = stats.badges.length;
            modal.style.display = 'flex';
        }

        function closeBadges() {
            document.getElementById('badgeModal').style.display = 'none';
        }

        // ì´ˆê¸° ë¬¸ì œ ìƒì„±
        generateNewProblem();
    </script>
</body>
</html>