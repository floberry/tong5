<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìë™ì°¨ ì—ë„ˆì§€ íš¨ìœ¨ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b00 50%, #1a0000 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,.1) 2px,
                rgba(0,0,0,.1) 4px
            );
            pointer-events: none;
        }
        
        .container {
            background: #2a2a2a;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8), inset 0 0 20px rgba(255,0,0,0.1);
            max-width: 500px;
            width: 100%;
            padding: 30px;
            border: 2px solid #4a0000;
            position: relative;
            z-index: 1;
            max-height: 90vh;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .container::-webkit-scrollbar {
            width: 8px;
        }
        
        .container::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 10px;
        }
        
        .container::-webkit-scrollbar-thumb {
            background: #ff4444;
            border-radius: 10px;
        }
        
        .container::-webkit-scrollbar-thumb:hover {
            background: #ff6666;
        }
        
        .intro-screen, .problem-screen, .result-screen {
            display: none;
        }
        
        .intro-screen.active, .problem-screen.active, .result-screen.active {
            display: block;
        }
        
        h1 {
            color: #ff4444;
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 0 0 10px rgba(255,0,0,0.5);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .car-icon {
            display: inline-block;
            animation: carMove 2s ease-in-out infinite;
        }
        
        @keyframes carMove {
            0%, 100% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
        }
        
        .intro-text {
            background: rgba(139, 0, 0, 0.2);
            border-left: 4px solid #ff4444;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 16px;
            color: #ffcccc;
            box-shadow: 0 0 20px rgba(255,0,0,0.1);
        }
        
        .intro-illustration {
            background: rgba(0,0,0,0.3);
            border: 2px solid #ff4444;
            border-radius: 10px;
            padding: 30px 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .scene {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 180px;
            position: relative;
            padding: 0 10px;
        }
        
        .zombie {
            font-size: 50px;
            animation: zombieWalk 1s infinite;
            position: absolute;
            right: 20px;
            bottom: 20px;
        }
        
        @keyframes zombieWalk {
            0%, 100% { transform: translateX(0) rotate(-5deg); }
            50% { transform: translateX(-5px) rotate(5deg); }
        }
        
        .person {
            font-size: 40px;
            animation: personRun 0.5s infinite;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 20px;
        }
        
        @keyframes personRun {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        .cars {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            position: absolute;
            left: 20px;
            bottom: 20px;
        }
        
        .car {
            font-size: 30px;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }
        
        .speech-bubble {
            position: absolute;
            background: rgba(255,255,255,0.95);
            color: #d32f2f;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            white-space: nowrap;
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid rgba(255,255,255,0.95);
        }
        
        .problem-text {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 14px;
            color: #ddd;
            border: 1px solid #444;
        }
        
        .diagram-container {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        
        .diagram-title {
            color: #ff8888;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .flow-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .flow-box {
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            padding: 15px 30px;
            border-radius: 10px;
            color: #ffcccc;
            font-weight: bold;
            text-align: center;
            min-width: 150px;
        }
        
        .flow-arrow {
            color: #ff4444;
            font-size: 30px;
            line-height: 1;
        }
        
        .flow-storage {
            background: rgba(255, 68, 68, 0.1);
            border: 3px dashed #ff4444;
            padding: 20px;
            border-radius: 50%;
            color: #ffcccc;
            font-weight: bold;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
        }
        
        .flow-middle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            position: relative;
            left: 70px;
        }
        
        .flow-side {
            background: rgba(68, 255, 68, 0.2);
            border: 2px solid #44ff44;
            padding: 10px 20px;
            border-radius: 10px;
            color: #ccffcc;
            font-weight: bold;
            text-align: center;
            font-size: 14px;
        }
        
        .flow-arrow-right {
            color: #44ff44;
            font-size: 25px;
            line-height: 1;
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            border: 2px solid #666;
            border-radius: 8px;
            margin: 20px 0;
            background: #1a1a1a;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        canvas {
            width: 100%;
            height: 100%;
        }
        
        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background: #1a1a1a;
            border: 2px solid #ff4444;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #ff4444;
            box-shadow: 0 0 10px rgba(255,0,0,0.2);
        }
        
        .choice-btn:hover {
            background: rgba(255, 68, 68, 0.1);
            box-shadow: 0 0 20px rgba(255,0,0,0.4);
        }
        
        .choice-btn.selected {
            background: #ff4444;
            color: #1a1a1a;
            box-shadow: 0 0 30px rgba(255,0,0,0.6);
        }
        
        .btn {
            background: #8b0000;
            color: #ffcccc;
            border: 2px solid #ff4444;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(255,0,0,0.3);
        }
        
        .btn:hover {
            background: #a50000;
            transform: translateY(-2px);
            box-shadow: 0 5px 25px rgba(255,0,0,0.5);
        }
        
        .result-box {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        
        .result-box.correct {
            background: rgba(0, 100, 0, 0.3);
            color: #66ff66;
            border: 2px solid #00ff00;
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
        }
        
        .result-box.wrong {
            background: rgba(139, 0, 0, 0.3);
            color: #ff6666;
            border: 2px solid #ff0000;
            box-shadow: 0 0 20px rgba(255,0,0,0.3);
        }
        
        .explanation {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 14px;
            color: #ddd;
            border: 1px solid #444;
        }
        
        .explanation strong {
            color: #ff8888;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì‹œì‘ í™”ë©´ -->
        <div class="intro-screen active">
            <h1>ğŸ§Ÿ ì¢€ë¹„ ì‚¬íƒœ ë°œìƒ!</h1>
            
            <div class="intro-illustration">
                <div class="scene">
                    <div class="zombie">ğŸ§Ÿ</div>
                    <div class="person">ğŸƒ</div>
                    <div class="speech-bubble">ì‚´ë ¤ì¤˜!</div>
                    <div class="cars">
                        <div class="car">ğŸš—</div>
                        <div class="car">ğŸš™</div>
                        <div class="car">ğŸš•</div>
                        <div class="car">ğŸš</div>
                    </div>
                </div>
            </div>
            
            <div class="intro-text">
                <p>ì¢€ë¹„ ì‚¬íƒœê°€ ë°œìƒí–ˆë‹¤! ìµœëŒ€í•œ ì ì€ ì—ë„ˆì§€ë¡œ ì˜¤ë˜ ë‹¬ë¦´ ìˆ˜ ìˆëŠ” ìë™ì°¨ë¥¼ íƒ€ì•¼ í•œë‹¤. ìë™ì°¨ A~D ì¤‘ ì—ë„ˆì§€ íš¨ìœ¨ì´ ê°€ì¥ ë†’ì€ ìë™ì°¨ë¥¼ ê³¨ë¼ ë„ë§ì¹˜ì!</p>
            </div>
            <button class="btn" onclick="startProblem()">OK</button>
        </div>
        
        <!-- ë¬¸ì œ í™”ë©´ -->
        <div class="problem-screen">
            <h1><span class="car-icon">ğŸš—</span> ìë™ì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”</h1>
            <div class="problem-text">
                ê·¸ë¦¼ (ê°€)ëŠ” ì—ë„ˆì§€ì˜ íë¦„ì„ ë‚˜íƒ€ë‚¸ ê²ƒì´ê³ , ê·¸ë¦¼ (ë‚˜)ëŠ” ìë™ì°¨ A~Dì—ì„œ ê³µê¸‰ëœ ì—ë„ˆì§€ì™€ ë²„ë ¤ì§„ ì—ë„ˆì§€ë¥¼ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤. ì´ë•Œ, ì—ë„ˆì§€ íš¨ìœ¨ì´ ê°€ì¥ ë†’ì€ ìë™ì°¨ëŠ”?
            </div>
            
            <div class="diagram-container">
                <div class="diagram-title">ê·¸ë¦¼ (ê°€)</div>
                <div class="flow-diagram">
                    <div class="flow-box">ê³µê¸‰ëœ ì—ë„ˆì§€</div>
                    <div class="flow-arrow">â–¼</div>
                    <div class="flow-middle">
                        <div class="flow-storage">ì—ë„ˆì§€ ì¥ì¹˜</div>
                        <div class="flow-arrow-right">â–¶</div>
                        <div class="flow-side">ìœ ìš©í•œ<br>ì—ë„ˆì§€(ì¼)</div>
                    </div>
                    <div class="flow-arrow">â–¼</div>
                    <div class="flow-box">ë²„ë ¤ì§„ ì—ë„ˆì§€</div>
                </div>
            </div>
            
            <div class="diagram-container">
                <div class="diagram-title">ê·¸ë¦¼ (ë‚˜)</div>
                <div class="chart-container">
                    <canvas id="chart"></canvas>
                </div>
            </div>
            
            <div class="choices">
                <button class="choice-btn" onclick="selectChoice('A')">ìë™ì°¨ A</button>
                <button class="choice-btn" onclick="selectChoice('B')">ìë™ì°¨ B</button>
                <button class="choice-btn" onclick="selectChoice('C')">ìë™ì°¨ C</button>
                <button class="choice-btn" onclick="selectChoice('D')">ìë™ì°¨ D</button>
            </div>
            
            <button class="btn" id="checkBtn" style="display:none;" onclick="checkAnswer()">ì •ë‹µ í™•ì¸í•˜ê¸°</button>
        </div>
        
        <!-- ê²°ê³¼ í™”ë©´ -->
        <div class="result-screen">
            <div class="result-box" id="resultBox"></div>
            <div class="explanation" id="explanation"></div>
            <button class="btn" onclick="restart()">ë‹¤ì‹œí•˜ê¸°</button>
        </div>
    </div>

    <script>
        let selectedAnswer = null;
        let correctAnswer = null;
        let carData = {};
        
        function generateProblem() {
            const cars = ['A', 'B', 'C', 'D'];
            
            // ë‹¤ì–‘í•œ ë°ì´í„°ì…‹ ìƒì„± (ë§¤ë²ˆ ë‹¤ë¥¸ ê°’)
            const possibleData = [
                {supply: 10, emission: 2},  // íš¨ìœ¨: 80%
                {supply: 8, emission: 2},   // íš¨ìœ¨: 75%
                {supply: 10, emission: 4},  // íš¨ìœ¨: 60%
                {supply: 8, emission: 4},   // íš¨ìœ¨: 50%
                {supply: 6, emission: 2},   // íš¨ìœ¨: 66.7%
                {supply: 6, emission: 4},   // íš¨ìœ¨: 33.3%
                {supply: 10, emission: 6},  // íš¨ìœ¨: 40%
                {supply: 8, emission: 6},   // íš¨ìœ¨: 25%
                {supply: 4, emission: 2},   // íš¨ìœ¨: 50%
                {supply: 10, emission: 8}   // íš¨ìœ¨: 20%
            ];
            
            // ëœë¤í•˜ê²Œ 4ê°œ ì„ íƒ
            const shuffled = possibleData.sort(() => Math.random() - 0.5);
            const selectedData = shuffled.slice(0, 4);
            
            // ê° ìë™ì°¨ì— í• ë‹¹
            carData = {};
            for (let i = 0; i < cars.length; i++) {
                const car = cars[i];
                carData[car] = {
                    supply: selectedData[i].supply,
                    emission: selectedData[i].emission,
                    efficiency: (1 - (selectedData[i].emission / selectedData[i].supply)) * 100
                };
            }
            
            // ì •ë‹µ ì°¾ê¸° (íš¨ìœ¨ì´ ê°€ì¥ ë†’ì€ ê²ƒ)
            let maxEfficiency = 0;
            correctAnswer = null;
            for (let car of cars) {
                if (carData[car].efficiency > maxEfficiency) {
                    maxEfficiency = carData[car].efficiency;
                    correctAnswer = car;
                }
            }
            
            // ë™ì  ë°©ì§€ - ë§Œì•½ ê°™ì€ íš¨ìœ¨ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ìƒì„±
            const efficiencies = cars.map(car => carData[car].efficiency);
            const uniqueEfficiencies = [...new Set(efficiencies)];
            if (efficiencies.length !== uniqueEfficiencies.length) {
                // ì¬ê·€ì ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±
                generateProblem();
            }
        }
        
        function drawChart() {
            const canvas = document.getElementById('chart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            // ì¶• ê·¸ë¦¬ê¸°
            const margin = 40;
            const chartWidth = width - margin * 2;
            const chartHeight = height - margin * 2;
            
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, height - margin);
            ctx.lineTo(width - margin, height - margin);
            ctx.stroke();
            
            // ì¶• ë¼ë²¨
            ctx.fillStyle = '#aaa';
            ctx.font = '12px Malgun Gothic';
            ctx.textAlign = 'center';
            ctx.fillText('ê³µê¸‰ëœ ì—ë„ˆì§€', width / 2, height - 5);
            
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ë²„ë ¤ì§„ ì—ë„ˆì§€', 0, 0);
            ctx.restore();
            
            // ëˆˆê¸ˆ ê·¸ë¦¬ê¸°
            const maxValue = 10;
            ctx.font = '10px Malgun Gothic';
            ctx.fillStyle = '#888';
            
            for (let i = 0; i <= maxValue; i += 2) {
                const x = margin + (i / maxValue) * chartWidth;
                const y = height - margin - (i / maxValue) * chartHeight;
                
                // Xì¶• ëˆˆê¸ˆ
                ctx.textAlign = 'center';
                ctx.fillText(i + 'Q', x, height - margin + 15);
                
                // Yì¶• ëˆˆê¸ˆ
                ctx.textAlign = 'right';
                ctx.fillText(i + 'Q', margin - 5, y + 3);
                
                // ê²©ìì„ 
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.setLineDash([2, 2]);
                ctx.beginPath();
                ctx.moveTo(margin, y);
                ctx.lineTo(width - margin, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, margin);
                ctx.lineTo(x, height - margin);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // ë°ì´í„° ì  ê·¸ë¦¬ê¸°
            const colors = {A: '#ff4444', B: '#44ff44', C: '#4444ff', D: '#ffaa00'};
            
            for (let car in carData) {
                const x = margin + (carData[car].supply / maxValue) * chartWidth;
                const y = height - margin - (carData[car].emission / maxValue) * chartHeight;
                
                // ì ì— ë°œê´‘ íš¨ê³¼
                ctx.shadowColor = colors[car];
                ctx.shadowBlur = 15;
                ctx.fillStyle = colors[car];
                ctx.beginPath();
                ctx.arc(x, y, 7, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
                
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px Malgun Gothic';
                ctx.textAlign = 'center';
                ctx.fillText(car, x + 15, y - 10);
            }
        }
        
        function startProblem() {
            document.querySelector('.intro-screen').classList.remove('active');
            document.querySelector('.problem-screen').classList.add('active');
            generateProblem();
            drawChart();
        }
        
        function selectChoice(choice) {
            const buttons = document.querySelectorAll('.choice-btn');
            const checkBtn = document.getElementById('checkBtn');
            
            if (selectedAnswer === choice) {
                // ê°™ì€ ë²„íŠ¼ ë‹¤ì‹œ í´ë¦­ ì‹œ ì„ íƒ ì·¨ì†Œ
                selectedAnswer = null;
                buttons.forEach(btn => btn.classList.remove('selected'));
                checkBtn.style.display = 'none';
            } else {
                // ìƒˆë¡œìš´ ì„ íƒ
                selectedAnswer = choice;
                buttons.forEach(btn => btn.classList.remove('selected'));
                event.target.classList.add('selected');
                checkBtn.style.display = 'block';
            }
        }
        
        function checkAnswer() {
            const isCorrect = selectedAnswer === correctAnswer;
            
            document.querySelector('.problem-screen').classList.remove('active');
            document.querySelector('.result-screen').classList.add('active');
            
            const resultBox = document.getElementById('resultBox');
            const explanation = document.getElementById('explanation');
            
            if (isCorrect) {
                resultBox.className = 'result-box correct';
                resultBox.textContent = 'ğŸ‰ ì •ë‹µ! ì¢€ë¹„ë¥¼ í”¼í•´ ë¬´ì‚¬íˆ ë„ë§ì³¤ë‹¤!';
            } else {
                resultBox.className = 'result-box wrong';
                resultBox.textContent = 'ğŸ˜± ì˜¤ë‹µ! ë„ë§ì— ì‹¤íŒ¨í•´ì„œ ì¢€ë¹„ê°€ ë˜ì—ˆë‹¤!';
            }
            
            // í’€ì´ ì„¤ëª…
            let explanationText = '<strong>ã€í’€ì´ã€‘</strong><br><br>';
            explanationText += 'ì—ë„ˆì§€ íš¨ìœ¨ = 1 - (ë²„ë ¤ì§„ ì—ë„ˆì§€ / ê³µê¸‰ëœ ì—ë„ˆì§€)<br><br>';
            
            for (let car of ['A', 'B', 'C', 'D']) {
                const efficiencyPercent = carData[car].efficiency.toFixed(1);
                explanationText += `<strong>ìë™ì°¨ ${car}:</strong> 1 - (${carData[car].emission}Q / ${carData[car].supply}Q) = 1 - ${(carData[car].emission / carData[car].supply).toFixed(2)} = <strong>${(carData[car].efficiency / 100).toFixed(2)} (${efficiencyPercent}%)</strong><br>`;
            }
            
            explanationText += `<br>ë”°ë¼ì„œ ì—ë„ˆì§€ íš¨ìœ¨ì´ ê°€ì¥ ë†’ì€ ìë™ì°¨ëŠ” <strong>${correctAnswer} (${carData[correctAnswer].efficiency.toFixed(1)}%)</strong>ì…ë‹ˆë‹¤.`;
            
            explanation.innerHTML = explanationText;
        }
        
        function restart() {
            selectedAnswer = null;
            document.querySelector('.result-screen').classList.remove('active');
            document.querySelector('.intro-screen').classList.add('active');
            
            // ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('checkBtn').style.display = 'none';
        }
        
        // ì´ˆê¸°í™”
        window.addEventListener('resize', () => {
            if (document.querySelector('.problem-screen').classList.contains('active')) {
                drawChart();
            }
        });
    </script>
</body>
</html>