<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ë„ˆì§€ íš¨ìœ¨ ë¬¸ì œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }
        
        .question-text {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #333;
            font-weight: 500;
        }
        
        .diagram {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .device-image {
            width: 100%;
            max-width: 320px;
            height: 220px;
            margin: 0 auto 20px;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        
        .device-visual {
            position: relative;
            z-index: 1;
        }
        
        .energy-flow {
            margin: 20px 0;
            text-align: center;
        }
        
        .energy-box {
            display: inline-block;
            padding: 14px 24px;
            margin: 5px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            position: relative;
            transition: transform 0.3s;
        }
        
        .energy-box:hover {
            transform: translateY(-2px);
        }
        
        .electric {
            background: linear-gradient(145deg, #ff8787, #ff6b6b);
            color: white;
        }
        
        .light {
            background: linear-gradient(145deg, #ffe066, #ffd93d);
            color: #333;
        }
        
        .sound {
            background: linear-gradient(145deg, #8ce99a, #6bcf7f);
            color: white;
        }
        
        .heat {
            background: linear-gradient(145deg, #ffa07a, #ff8787);
            color: white;
        }
        
        .motion {
            background: linear-gradient(145deg, #74c0fc, #4dabf7);
            color: white;
        }
        
        .unknown {
            background: linear-gradient(145deg, #c5c5c5, #adb5bd);
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .arrow {
            font-size: 28px;
            color: #667eea;
            margin: 0 10px;
        }
        
        .options-label {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            border: 2px dashed #667eea;
        }
        
        .statements {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 18px;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .statement {
            padding: 14px;
            margin: 12px 0;
            background: white;
            border-radius: 10px;
            font-size: 15px;
            line-height: 1.6;
            border-left: 5px solid #ddd;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }
        
        .statement:hover {
            border-left-color: #667eea;
            background: linear-gradient(145deg, #ffffff, #f0f4ff);
            transform: translateX(5px);
        }
        
        .statement.selected {
            border-left-color: #667eea;
            background: linear-gradient(145deg, #e0e7ff, #d0d9ff);
            font-weight: bold;
        }
        
        .statement.correct {
            border-left-color: #51cf66;
            background: linear-gradient(145deg, #d3f9d8, #b2f2bb);
        }
        
        .statement.incorrect {
            border-left-color: #ff6b6b;
            background: linear-gradient(145deg, #ffe3e3, #ffc9c9);
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .new-problem-btn {
            background: linear-gradient(145deg, #7c8de8, #667eea);
            color: white;
        }
        
        .new-problem-btn:hover {
            background: linear-gradient(145deg, #667eea, #5568d3);
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(102,126,234,0.35);
        }
        
        .submit-btn {
            background: linear-gradient(145deg, #69db7c, #51cf66);
            color: white;
        }
        
        .submit-btn:hover {
            background: linear-gradient(145deg, #51cf66, #40c057);
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(81,207,102,0.35);
        }
        
        .submit-btn:disabled {
            background: linear-gradient(145deg, #dee2e6, #ccc);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 17px;
            font-weight: bold;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .result.show {
            display: block;
        }
        
        .result.correct {
            background: linear-gradient(145deg, #d3f9d8, #b2f2bb);
            color: #2b8a3e;
            border: 3px solid #51cf66;
        }
        
        .result.incorrect {
            background: linear-gradient(145deg, #ffe3e3, #ffc9c9);
            color: #c92a2a;
            border: 3px solid #ff6b6b;
        }
        
        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            text-align: left;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            font-weight: normal;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.08);
        }
        
        .explanation strong {
            color: #c92a2a;
            display: block;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ ì—ë„ˆì§€ ì „í™˜ê³¼ íš¨ìœ¨ ë¬¸ì œ</h1>
        
        <div class="question-text" id="questionText"></div>
        
        <div class="diagram">
            <div class="device-image" id="deviceImage"></div>
            <div class="energy-flow" id="energyFlow"></div>
        </div>
        
        <div class="options-label">< ë³´ê¸° ></div>
        
        <div class="statements" id="statements"></div>
        
        <div class="result" id="result"></div>
        
        <div class="buttons">
            <button class="new-problem-btn" onclick="newProblem()">ğŸ”„ ìƒˆ ë¬¸ì œ</button>
            <button class="submit-btn" id="submitBtn" onclick="checkAnswer()" disabled>âœ“ ì •ë‹µ í™•ì¸</button>
        </div>
    </div>

    <script>
        const deviceTemplates = [
            {
                device: 'TV',
                svg: `<svg width="200" height="150" viewBox="0 0 200 150">
                    <rect x="20" y="20" width="160" height="100" rx="5" fill="#2c3e50" stroke="#34495e" stroke-width="3"/>
                    <rect x="30" y="30" width="140" height="80" fill="#3498db"/>
                    <rect x="85" y="125" width="30" height="15" fill="#34495e"/>
                    <rect x="60" y="140" width="80" height="5" rx="2" fill="#7f8c8d"/>
                </svg>`,
                energyInput: 100,
                useful: [
                    { type: 'ë¹›ì—ë„ˆì§€', value: 30, class: 'light' },
                    { type: 'ì†Œë¦¬ ì—ë„ˆì§€', value: 20, class: 'sound' }
                ],
                wasteValue: 50
            },
            {
                device: 'ì „ë“±',
                svg: `<svg width="200" height="150" viewBox="0 0 200 150">
                    <ellipse cx="100" cy="60" rx="40" ry="50" fill="#fff9c4" opacity="0.5"/>
                    <ellipse cx="100" cy="60" rx="35" ry="45" fill="#fff59d" opacity="0.7"/>
                    <path d="M 100 20 Q 70 35 70 65 L 70 85 Q 70 95 80 95 L 120 95 Q 130 95 130 85 L 130 65 Q 130 35 100 20 Z" fill="#ffd54f" stroke="#fbc02d" stroke-width="2"/>
                    <circle cx="100" cy="55" r="8" fill="#fff176" opacity="0.8"/>
                    <rect x="88" y="95" width="24" height="18" fill="#9e9e9e" stroke="#757575" stroke-width="1"/>
                    <path d="M 83 113 L 90 133 L 110 133 L 117 113 Z" fill="#757575" stroke="#616161" stroke-width="1"/>
                    <rect x="95" y="133" width="10" height="5" fill="#616161"/>
                </svg>`,
                energyInput: 80,
                useful: [
                    { type: 'ë¹›ì—ë„ˆì§€', value: 20, class: 'light' }
                ],
                wasteValue: 60
            },
            {
                device: 'ìŠ¤í”¼ì»¤',
                svg: `<svg width="200" height="150" viewBox="0 0 200 150">
                    <rect x="50" y="20" width="100" height="110" rx="8" fill="#37474f" stroke="#263238" stroke-width="3"/>
                    <circle cx="100" cy="60" r="25" fill="#546e7a" stroke="#263238" stroke-width="2"/>
                    <circle cx="100" cy="60" r="18" fill="#455a64"/>
                    <circle cx="100" cy="60" r="8" fill="#263238"/>
                    <circle cx="100" cy="110" r="15" fill="#546e7a" stroke="#263238" stroke-width="2"/>
                    <circle cx="100" cy="110" r="8" fill="#263238"/>
                </svg>`,
                energyInput: 60,
                useful: [
                    { type: 'ì†Œë¦¬ ì—ë„ˆì§€', value: 20, class: 'sound' }
                ],
                wasteValue: 40
            },
            {
                device: 'ì„¸íƒê¸°',
                svg: `<svg width="200" height="150" viewBox="0 0 200 150">
                    <rect x="50" y="20" width="100" height="110" rx="8" fill="#eceff1" stroke="#90a4ae" stroke-width="3"/>
                    <rect x="60" y="30" width="80" height="25" rx="3" fill="#b0bec5"/>
                    <circle cx="75" cy="42" r="4" fill="#4caf50"/>
                    <circle cx="90" cy="42" r="4" fill="#2196f3"/>
                    <circle cx="130" cy="42" r="8" fill="#546e7a"/>
                    <circle cx="100" cy="90" r="32" fill="#90a4ae" stroke="#607d8b" stroke-width="3"/>
                    <circle cx="100" cy="90" r="25" fill="#b0bec5"/>
                    <path d="M 85 80 Q 100 95 115 80" stroke="#607d8b" stroke-width="2" fill="none"/>
                </svg>`,
                energyInput: 200,
                useful: [
                    { type: 'ìš´ë™ ì—ë„ˆì§€', value: 140, class: 'motion' }
                ],
                wasteValue: 60
            },
            {
                device: 'ì „ê¸°ë°¥ì†¥',
                svg: `<svg width="200" height="150" viewBox="0 0 200 150">
                    <ellipse cx="100" cy="110" rx="50" ry="15" fill="#d32f2f"/>
                    <rect x="50" y="60" width="100" height="50" fill="#f44336" stroke="#c62828" stroke-width="2"/>
                    <ellipse cx="100" cy="60" rx="50" ry="15" fill="#e57373"/>
                    <path d="M 80 50 Q 100 35 120 50" fill="none" stroke="#9e9e9e" stroke-width="4" stroke-linecap="round"/>
                    <rect x="85" y="65" width="30" height="15" rx="3" fill="#424242"/>
                    <circle cx="130" cy="72" r="5" fill="#4caf50"/>
                </svg>`,
                energyInput: 100,
                useful: [
                    { type: 'ì—´ì—ë„ˆì§€', value: 70, class: 'heat' }
                ],
                wasteValue: 30
            }
        ];

        const problemPool = [];
        let currentProblem = null;
        let selectedStatements = new Set();

        function generateRandomProblems() {
            problemPool.length = 0;
            
            deviceTemplates.forEach(template => {
                const statements = generateDiverseStatements(template);
                statements.forEach(statementSet => {
                    problemPool.push({
                        device: template.device,
                        svg: template.svg,
                        energyInput: template.energyInput,
                        useful: template.useful,
                        wasteValue: template.wasteValue,
                        statements: statementSet
                    });
                });
            });
        }

        function generateDiverseStatements(template) {
            const allStatementSets = [];
            const totalUseful = template.useful.reduce((sum, e) => sum + e.value, 0);
            const efficiency = (totalUseful / template.energyInput * 100);
            const roundedEfficiency = Math.round(efficiency / 10) * 10;
            
            const allPossibleStatements = [
                // íš¨ìœ¨ ê³„ì‚° (ì´ìƒ)
                {
                    text: `${template.device}ì˜ ì—ë„ˆì§€ íš¨ìœ¨ì€ ${roundedEfficiency}% ì´ìƒì´ë‹¤.`,
                    isCorrect: efficiency >= roundedEfficiency,
                    explanation: `ì—ë„ˆì§€ íš¨ìœ¨ = (ìœ ìš©í•œ ì—ë„ˆì§€/íˆ¬ì… ì—ë„ˆì§€) Ã— 100 = (${totalUseful}/${template.energyInput}) Ã— 100 = ${efficiency.toFixed(1)}%ì…ë‹ˆë‹¤.`
                },
                // íš¨ìœ¨ ê³„ì‚° (ì´í•˜)
                {
                    text: `${template.device}ì˜ ì—ë„ˆì§€ íš¨ìœ¨ì€ ${roundedEfficiency}% ì´í•˜ì´ë‹¤.`,
                    isCorrect: efficiency <= roundedEfficiency,
                    explanation: `ì—ë„ˆì§€ íš¨ìœ¨ = (ìœ ìš©í•œ ì—ë„ˆì§€/íˆ¬ì… ì—ë„ˆì§€) Ã— 100 = (${totalUseful}/${template.energyInput}) Ã— 100 = ${efficiency.toFixed(1)}%ì…ë‹ˆë‹¤.`
                },
                // ì—´ì—ë„ˆì§€ ì–‘ ê³„ì‚° (ì •ë‹µ)
                {
                    text: `?ë¡œ ì „í™˜ëœ ì—ë„ˆì§€ì˜ ì–‘ì€ ${template.wasteValue}ì´ë‹¤.`,
                    isCorrect: true,
                    explanation: `íˆ¬ì… ì—ë„ˆì§€ ${template.energyInput} - ìœ ìš©í•œ ì—ë„ˆì§€ ${totalUseful} = ${template.wasteValue}ì´ë¯€ë¡œ ì—´ì—ë„ˆì§€ë¡œ ì „í™˜ëœ ì–‘ì€ ${template.wasteValue}ì…ë‹ˆë‹¤.`
                },
                // ì—´ì—ë„ˆì§€ ì–‘ ê³„ì‚° (ì˜¤ë‹µ)
                {
                    text: `?ë¡œ ì „í™˜ëœ ì—ë„ˆì§€ì˜ ì–‘ì€ ${template.wasteValue + 10}ì´ë‹¤.`,
                    isCorrect: false,
                    explanation: `íˆ¬ì… ì—ë„ˆì§€ ${template.energyInput} - ìœ ìš©í•œ ì—ë„ˆì§€ ${totalUseful} = ${template.wasteValue}ì´ë¯€ë¡œ ${template.wasteValue + 10}ì´ ì•„ë‹™ë‹ˆë‹¤.`
                },
                // ?ëŠ” ì—´ì—ë„ˆì§€
                {
                    text: `?ëŠ” ì—´ì—ë„ˆì§€ì´ë‹¤.`,
                    isCorrect: true,
                    explanation: `ëª¨ë“  ê¸°ê¸°ì—ì„œ ë²„ë ¤ì§€ëŠ” ì—ë„ˆì§€ëŠ” ì—´ì—ë„ˆì§€ì…ë‹ˆë‹¤.`
                },
                // ìœ ìš©í•œ ì—ë„ˆì§€ ì—¬ë¶€
                {
                    text: `?ëŠ” ${template.device}ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë˜ëŠ” ì—ë„ˆì§€ì´ë‹¤.`,
                    isCorrect: template.device === 'ì „ê¸°ë°¥ì†¥',
                    explanation: template.device === 'ì „ê¸°ë°¥ì†¥' 
                        ? `ì „ê¸°ë°¥ì†¥ì€ ì—´ì—ë„ˆì§€ë¥¼ ì´ìš©í•´ ë°¥ì„ ì§“ê¸° ë•Œë¬¸ì— ?ì¸ ì—´ì—ë„ˆì§€ê°€ ìœ ìš©í•œ ì—ë„ˆì§€ì…ë‹ˆë‹¤.`
                        : `${template.device}ì—ì„œ ?ì¸ ì—´ì—ë„ˆì§€ëŠ” ë²„ë ¤ì§€ëŠ” ì—ë„ˆì§€ë¡œ, ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`
                },
                // ìœ ìš©í•œ ì—ë„ˆì§€ì™€ ì—´ì—ë„ˆì§€ ë¹„êµ
                {
                    text: `ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë˜ëŠ” ì—ë„ˆì§€ê°€ ?ë³´ë‹¤ í¬ë‹¤.`,
                    isCorrect: totalUseful > template.wasteValue,
                    explanation: totalUseful > template.wasteValue
                        ? `ìœ ìš©í•œ ì—ë„ˆì§€(${totalUseful})ê°€ ì—´ì—ë„ˆì§€(${template.wasteValue})ë³´ë‹¤ í½ë‹ˆë‹¤.`
                        : `ìœ ìš©í•œ ì—ë„ˆì§€(${totalUseful})ê°€ ì—´ì—ë„ˆì§€(${template.wasteValue})ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìŠµë‹ˆë‹¤.`
                },
                {
                    text: `?ê°€ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë˜ëŠ” ì—ë„ˆì§€ë³´ë‹¤ í¬ë‹¤.`,
                    isCorrect: template.wasteValue > totalUseful,
                    explanation: template.wasteValue > totalUseful
                        ? `ì—´ì—ë„ˆì§€(${template.wasteValue})ê°€ ìœ ìš©í•œ ì—ë„ˆì§€(${totalUseful})ë³´ë‹¤ í½ë‹ˆë‹¤.`
                        : `ì—´ì—ë„ˆì§€(${template.wasteValue})ê°€ ìœ ìš©í•œ ì—ë„ˆì§€(${totalUseful})ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìŠµë‹ˆë‹¤.`
                },
                // íš¨ìœ¨ì´ 50% ì´ìƒ/ì´í•˜
                {
                    text: `${template.device}ì˜ ì—ë„ˆì§€ íš¨ìœ¨ì€ 50% ì´ìƒì´ë‹¤.`,
                    isCorrect: efficiency >= 50,
                    explanation: `ì—ë„ˆì§€ íš¨ìœ¨ = (${totalUseful}/${template.energyInput}) Ã— 100 = ${efficiency.toFixed(1)}%ì…ë‹ˆë‹¤.`
                },
                {
                    text: `${template.device}ì˜ ì—ë„ˆì§€ íš¨ìœ¨ì€ 50% ì´í•˜ì´ë‹¤.`,
                    isCorrect: efficiency <= 50,
                    explanation: `ì—ë„ˆì§€ íš¨ìœ¨ = (${totalUseful}/${template.energyInput}) Ã— 100 = ${efficiency.toFixed(1)}%ì…ë‹ˆë‹¤.`
                },
                // íˆ¬ì… ì—ë„ˆì§€ì˜ ì ˆë°˜ ì´ìƒ/ì´í•˜ê°€ ìœ ìš©í•˜ê²Œ ì‚¬ìš©
                {
                    text: `íˆ¬ì…í•œ ì „ê¸° ì—ë„ˆì§€ì˜ ì ˆë°˜ ì´ìƒì´ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤.`,
                    isCorrect: totalUseful >= template.energyInput / 2,
                    explanation: totalUseful >= template.energyInput / 2
                        ? `ìœ ìš©í•œ ì—ë„ˆì§€(${totalUseful})ê°€ íˆ¬ì… ì—ë„ˆì§€(${template.energyInput})ì˜ ì ˆë°˜(${template.energyInput/2}) ì´ìƒì…ë‹ˆë‹¤.`
                        : `ìœ ìš©í•œ ì—ë„ˆì§€(${totalUseful})ê°€ íˆ¬ì… ì—ë„ˆì§€(${template.energyInput})ì˜ ì ˆë°˜(${template.energyInput/2})ë³´ë‹¤ ì‘ìŠµë‹ˆë‹¤.`
                },
                {
                    text: `íˆ¬ì…í•œ ì „ê¸° ì—ë„ˆì§€ì˜ ì ˆë°˜ ì´ìƒì´ ?ë¡œ ì „í™˜ëœë‹¤.`,
                    isCorrect: template.wasteValue >= template.energyInput / 2,
                    explanation: template.wasteValue >= template.energyInput / 2
                        ? `ì—´ì—ë„ˆì§€(${template.wasteValue})ê°€ íˆ¬ì… ì—ë„ˆì§€(${template.energyInput})ì˜ ì ˆë°˜(${template.energyInput/2}) ì´ìƒì…ë‹ˆë‹¤.`
                        : `ì—´ì—ë„ˆì§€(${template.wasteValue})ê°€ íˆ¬ì… ì—ë„ˆì§€(${template.energyInput})ì˜ ì ˆë°˜(${template.energyInput/2})ë³´ë‹¤ ì‘ìŠµë‹ˆë‹¤.`
                }
            ];
            
            // ì—ë„ˆì§€ íš¨ìœ¨ì— ì§‘ì¤‘í•œ ë‹¤ì–‘í•œ ì¡°í•© (ì¤‘ë³µ ì—†ì´)
            const combinations = [
                [0, 2, 6],   // íš¨ìœ¨(ì´ìƒ) + ì—´ ê³„ì‚° + ë¹„êµ
                [1, 4, 7],   // íš¨ìœ¨(ì´í•˜) + ?ëŠ” ì—´ + ë¹„êµ
                [0, 5, 10],  // íš¨ìœ¨(ì´ìƒ) + ìœ ìš©ì„± + ì ˆë°˜ ì´ìƒ ìœ ìš©
                [2, 8, 11],  // ì—´ ê³„ì‚° + 50% ì´ìƒ + ì ˆë°˜ ì´ìƒ ?
                [3, 6, 9],   // ì˜ëª»ëœ ì—´ + ë¹„êµ + 50% ì´í•˜
                [4, 7, 10],  // ?ëŠ” ì—´ + ë¹„êµ + ì ˆë°˜ ì´ìƒ ìœ ìš©
                [1, 2, 11],  // íš¨ìœ¨(ì´í•˜) + ì—´ ê³„ì‚° + ì ˆë°˜ ì´ìƒ ?
                [0, 4, 6]    // íš¨ìœ¨(ì´ìƒ) + ?ëŠ” ì—´ + ë¹„êµ
            ];
            
            combinations.forEach(combo => {
                const statements = combo.map((idx, i) => ({
                    label: ['ã„±', 'ã„´', 'ã„·'][i],
                    ...allPossibleStatements[idx]
                }));
                allStatementSets.push(statements);
            });
            
            return allStatementSets;
        }

        function loadProblem() {
            if (problemPool.length === 0) {
                generateRandomProblems();
            }
            
            const randomIndex = Math.floor(Math.random() * problemPool.length);
            currentProblem = problemPool[randomIndex];
            selectedStatements.clear();
            
            document.getElementById('questionText').innerHTML = 
                `ê·¸ë¦¼ì€ ${currentProblem.device}ë¥¼ ì¼¤ ë•Œ, ${currentProblem.device}ì—ì„œ ì¼ì–´ë‚˜ëŠ” ì—ë„ˆì§€ ì „í™˜ì„ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤.<br>
                ì´ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒë§Œì„ [ë³´ê¸°]ì—ì„œ ìˆëŠ” ëŒ€ë¡œ ê³ ë¥´ì‹œì˜¤.`;
            
            document.getElementById('deviceImage').innerHTML = currentProblem.svg;
            
            let flowHTML = `<div class="energy-box electric">ì „ê¸° ì—ë„ˆì§€ [${currentProblem.energyInput}]</div>`;
            flowHTML += '<br><span class="arrow">â†“</span><br>';
            
            currentProblem.useful.forEach((energy, index) => {
                if (index > 0) flowHTML += '<br><span class="arrow">â†“</span><br>';
                flowHTML += `<div class="energy-box ${energy.class}">${energy.type} [${energy.value}]</div>`;
            });
            
            flowHTML += '<br><span class="arrow">â†“</span><br>';
            flowHTML += `<div class="energy-box unknown">? [?]</div>`;
            
            document.getElementById('energyFlow').innerHTML = flowHTML;
            
            let statementsHTML = '';
            currentProblem.statements.forEach((stmt, index) => {
                statementsHTML += `<div class="statement" onclick="toggleStatement(${index})"><strong>${stmt.label}.</strong> ${stmt.text}</div>`;
            });
            document.getElementById('statements').innerHTML = statementsHTML;
            
            document.getElementById('result').classList.remove('show');
            document.getElementById('submitBtn').disabled = true;
        }

        function toggleStatement(index) {
            if (document.getElementById('result').classList.contains('show')) return;
            
            const statements = document.querySelectorAll('.statement');
            const label = currentProblem.statements[index].label;
            
            if (selectedStatements.has(label)) {
                selectedStatements.delete(label);
                statements[index].classList.remove('selected');
            } else {
                selectedStatements.add(label);
                statements[index].classList.add('selected');
            }
            
            document.getElementById('submitBtn').disabled = selectedStatements.size === 0;
        }
        
        function checkAnswer() {
            if (selectedStatements.size === 0) return;
            
            const resultDiv = document.getElementById('result');
            const statements = document.querySelectorAll('.statement');
            
            const correctLabels = new Set(
                currentProblem.statements.filter(s => s.isCorrect).map(s => s.label)
            );
            
            const isCorrect = selectedStatements.size === correctLabels.size &&
                            [...selectedStatements].every(label => correctLabels.has(label));
            
            currentProblem.statements.forEach((stmt, index) => {
                if (stmt.isCorrect) {
                    statements[index].classList.add('correct');
                } else if (selectedStatements.has(stmt.label)) {
                    statements[index].classList.add('incorrect');
                }
            });
            
            if (isCorrect) {
                resultDiv.innerHTML = '<div>âœ“ ì •ë‹µì…ë‹ˆë‹¤!</div>';
                resultDiv.className = 'result show correct';
            } else {
                const correctAnswer = [...correctLabels].sort().join(', ');
                
                let explanationHTML = `<div>âœ— í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ ${correctAnswer}ì…ë‹ˆë‹¤.</div>`;
                explanationHTML += '<div class="explanation">';
                explanationHTML += '<strong>ğŸ“– í’€ì´:</strong>';
                
                currentProblem.statements.forEach(stmt => {
                    const mark = stmt.isCorrect ? 'âœ“' : 'âœ—';
                    explanationHTML += `<div style="margin-top:8px">â€¢ <strong>${stmt.label} (${mark})</strong>: ${stmt.explanation}</div>`;
                });
                
                explanationHTML += '</div>';
                
                resultDiv.innerHTML = explanationHTML;
                resultDiv.className = 'result show incorrect';
            }
            
            document.getElementById('submitBtn').disabled = true;
        }
        
        function newProblem() {
            loadProblem();
        }
        
        generateRandomProblems();
        loadProblem();
    </script>
</body>
</html>