<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ë„ˆì§€ íš¨ìœ¨ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px 20px;
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .problem-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }
        
        .problem-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .problem-content {
            color: #212529;
            margin-bottom: 15px;
            font-size: 15px;
        }
        
        .multiple-answer-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            color: #856404;
            font-size: 14px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .data-table th, .data-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .data-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        
        .visual-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px;
        }
        
        .energy-diagram {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        
        .energy-box {
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }
        
        .input-energy {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            border: 2px solid #c92a2a;
        }
        
        .output-energy {
            background: linear-gradient(135deg, #51cf66, #37b24d);
            color: white;
            border: 2px solid #2b8a3e;
        }
        
        .arrow {
            font-size: 24px;
            color: #495057;
            font-weight: bold;
        }
        
        .plant-icon {
            font-size: 32px;
            margin: 0 5px;
        }
        
        .options {
            margin-top: 20px;
        }
        
        .option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .option:hover {
            background: #f8f9fa;
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .option.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }
        
        .option.wrong {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }
        
        .option-number {
            font-weight: bold;
            margin-right: 10px;
            font-size: 18px;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-new {
            background: #667eea;
            color: white;
        }
        
        .btn-new:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-check {
            background: #28a745;
            color: white;
        }
        
        .btn-check:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .result.wrong {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .result.partial {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }
        
        .explanation {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
            font-size: 14px;
            font-weight: normal;
            line-height: 1.8;
        }
        
        .explanation-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        .explanation-step {
            margin: 8px 0;
            padding-left: 10px;
        }
        
        .formula {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ ì—ë„ˆì§€ íš¨ìœ¨ ì‹œë®¬ë ˆì´ì…˜</h1>
        <div class="subtitle">í†µí•©ê³¼í•™ - ì—ë„ˆì§€ ì „í™˜ê³¼ íš¨ìœ¨</div>
        
        <div class="problem-box">
            <div class="problem-title" id="problemNumber">1ë²ˆ ë¬¸ì œ</div>
            <div class="problem-content" id="problemText"></div>
            <table class="data-table" id="dataTable"></table>
            <div class="multiple-answer-notice" id="multipleNotice" style="display: none;">
                âš ï¸ ì´ ë¬¸ì œëŠ” ë³µìˆ˜ ì •ë‹µì…ë‹ˆë‹¤. ì •ë‹µì„ ëª¨ë‘ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.
            </div>
            <div class="problem-content">
                ê³µê¸‰ëœ ì—ë„ˆì§€ì˜ ì–‘ì´ ê°™ì„ ë•Œ, A, B, Cì—ì„œ ìƒì‚°í•˜ëŠ” ì „ê¸° ì—ë„ˆì§€ì˜ ì–‘ì„ ì˜³ê²Œ ë¹„êµí•œ ê²ƒì€?
            </div>
        </div>
        
        <div class="options" id="options"></div>
        
        <div class="result" id="result"></div>
        
        <div class="buttons">
            <button class="btn btn-new" onclick="generateNewProblem()">ğŸ”„ ìƒˆ ë¬¸ì œ</button>
            <button class="btn btn-check" id="checkBtn" onclick="checkAnswer()">âœ“ ì •ë‹µ í™•ì¸</button>
        </div>
    </div>

    <script>
        let currentProblem = {};
        let selectedAnswers = [];
        let answered = false;
        let problemNumber = 1;

        function generateNewProblem() {
            // ëœë¤ ê°’ ìƒì„± (10 ë‹¨ìœ„)
            const inputA = Math.floor(Math.random() * 11) * 10; // 0-100
            const outputA = Math.floor(Math.random() * (inputA/10 + 1)) * 10;
            
            const inputB = Math.floor(Math.random() * 11) * 10;
            const outputB = Math.floor(Math.random() * (inputB/10 + 1)) * 10;
            
            const inputC = Math.floor(Math.random() * 11) * 10;
            const outputC = Math.floor(Math.random() * (inputC/10 + 1)) * 10;

            // íš¨ìœ¨ ê³„ì‚°
            const effA = inputA > 0 ? outputA / inputA : 0;
            const effB = inputB > 0 ? outputB / inputB : 0;
            const effC = inputC > 0 ? outputC / inputC : 0;

            // ê°™ì€ ì…ë ¥ ì—ë„ˆì§€ì— ëŒ€í•œ ì¶œë ¥ ë¹„êµë¥¼ ìœ„í•´ í‘œì¤€í™”
            const normalizedA = effA * 100;
            const normalizedB = effB * 100;
            const normalizedC = effC * 100;

            currentProblem = {
                inputA, outputA, effA: effA * 100,
                inputB, outputB, effB: effB * 100,
                inputC, outputC, effC: effC * 100,
                normalizedA, normalizedB, normalizedC
            };

            document.getElementById('problemNumber').textContent = `${problemNumber}ë²ˆ ë¬¸ì œ`;
            problemNumber = (problemNumber % 5) + 1; // 1-5 ìˆœí™˜

            displayProblem();
            generateOptions();
            resetAnswer();
        }

        function displayProblem() {
            const problemText = `í‘œëŠ” ì „ê¸° ì—ë„ˆì§€ë¥¼ ìƒì‚°í•˜ëŠ” ë°œì „ì†Œ A, B, Cì— ëŒ€í•œ ìë£Œì´ë‹¤.`;
            document.getElementById('problemText').innerHTML = problemText;

            const tableHTML = `
                <tr>
                    <th>ë°œì „ì†Œ</th>
                    <th>ë°œì „ ë°©ì‹</th>
                    <th>ì—ë„ˆì§€ ë³€í™˜ ê³¼ì •</th>
                </tr>
                <tr>
                    <td><strong>A</strong></td>
                    <td>ğŸ’§ ìˆ˜ë ¥ ë°œì „</td>
                    <td>
                        <div class="visual-row">
                            <div class="energy-diagram">
                                <div class="energy-box input-energy">${currentProblem.inputA} MJ</div>
                                <span class="arrow">â†’</span>
                                <span class="plant-icon">ğŸ­</span>
                                <span class="arrow">â†’</span>
                                <div class="energy-box output-energy">${currentProblem.outputA} MJ</div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><strong>B</strong></td>
                    <td>â˜€ï¸ íƒœì–‘ê´‘ ë°œì „</td>
                    <td>
                        <div class="visual-row">
                            <div class="energy-diagram">
                                <div class="energy-box input-energy">${currentProblem.inputB} kJ</div>
                                <span class="arrow">â†’</span>
                                <span class="plant-icon">ğŸ”†</span>
                                <span class="arrow">â†’</span>
                                <div class="energy-box output-energy">${currentProblem.outputB} kJ</div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><strong>C</strong></td>
                    <td>ğŸ”¥ í™”ë ¥ ë°œì „</td>
                    <td>
                        <div class="visual-row">
                            <div class="energy-diagram">
                                <div class="energy-box input-energy">${currentProblem.inputC} MJ</div>
                                <span class="arrow">â†’</span>
                                <span class="plant-icon">âš¡</span>
                                <span class="arrow">â†’</span>
                                <div class="energy-box output-energy">${currentProblem.outputC} MJ</div>
                            </div>
                        </div>
                    </td>
                </tr>
            `;
            document.getElementById('dataTable').innerHTML = tableHTML;
        }

        function generateOptions() {
            const values = [
                { name: 'A', value: currentProblem.normalizedA },
                { name: 'B', value: currentProblem.normalizedB },
                { name: 'C', value: currentProblem.normalizedC }
            ];

            // ì •ë ¬í•˜ì—¬ ì •ë‹µ ì°¾ê¸°
            const sorted = [...values].sort((a, b) => b.value - a.value);
            
            // ë™ì ì í™•ì¸
            const correctAnswers = [];
            const firstValue = sorted[0].value;
            
            // ê°€ì¥ ë†’ì€ íš¨ìœ¨ê³¼ ê°™ì€ ê°’ì„ ê°€ì§„ ëª¨ë“  ë°œì „ì†Œ ì°¾ê¸°
            for (let i = 0; i < sorted.length; i++) {
                if (Math.abs(sorted[i].value - firstValue) < 0.01) { // ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ ê³ ë ¤
                    correctAnswers.push(sorted[i].name);
                }
            }
            
            // ë³µìˆ˜ ì •ë‹µ ì—¬ë¶€ í™•ì¸
            const isMultipleAnswer = correctAnswers.length > 1;
            currentProblem.isMultipleAnswer = isMultipleAnswer;
            currentProblem.correctAnswers = correctAnswers;
            currentProblem.sorted = sorted;

            // ë³µìˆ˜ ì •ë‹µ ì•ˆë‚´ í‘œì‹œ
            const noticeElement = document.getElementById('multipleNotice');
            if (isMultipleAnswer) {
                noticeElement.style.display = 'block';
                noticeElement.textContent = `âš ï¸ ì´ ë¬¸ì œëŠ” ë³µìˆ˜ ì •ë‹µì…ë‹ˆë‹¤. ì •ë‹µ ${correctAnswers.length}ê°œë¥¼ ëª¨ë‘ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.`;
            } else {
                noticeElement.style.display = 'none';
            }

            // ì •ë‹µ ë¬¸ìì—´ ìƒì„± (ë“±í˜¸ í¬í•¨)
            function createAnswerString(sortedValues) {
                let result = sortedValues[0].name;
                for (let i = 1; i < sortedValues.length; i++) {
                    if (Math.abs(sortedValues[i].value - sortedValues[i-1].value) < 0.01) {
                        result += ' = ' + sortedValues[i].name;
                    } else {
                        result += ' > ' + sortedValues[i].name;
                    }
                }
                return result;
            }

            // ëª¨ë“  ê°€ëŠ¥í•œ ì¡°í•© ìƒì„±
            let allCombinations = [];
            
            if (isMultipleAnswer) {
                // ë³µìˆ˜ ì •ë‹µì¸ ê²½ìš°: íš¨ìœ¨ì´ ê°™ì€ ë°œì „ì†Œë“¤ì˜ ìˆœì—´ ìƒì„±
                const equalPlants = correctAnswers;
                const remainingPlants = sorted.filter(s => !equalPlants.includes(s.name)).map(s => s.name);
                
                // ê°™ì€ íš¨ìœ¨ì˜ ë°œì „ì†Œë“¤ì„ ìˆœì„œë¥¼ ë°”ê¿”ê°€ë©° ì¡°í•© ìƒì„±
                function permute(arr) {
                    if (arr.length <= 1) return [arr];
                    const result = [];
                    for (let i = 0; i < arr.length; i++) {
                        const current = arr[i];
                        const remaining = arr.slice(0, i).concat(arr.slice(i + 1));
                        const perms = permute(remaining);
                        for (const perm of perms) {
                            result.push([current, ...perm]);
                        }
                    }
                    return result;
                }
                
                const equalPerms = permute(equalPlants);
                
                for (const perm of equalPerms) {
                    const equalPart = perm.join(' = ');
                    if (remainingPlants.length > 0) {
                        allCombinations.push(equalPart + ' > ' + remainingPlants.join(' > '));
                    } else {
                        allCombinations.push(equalPart);
                    }
                }
            } else {
                // ë‹¨ì¼ ì •ë‹µì¸ ê²½ìš°: ê¸°ì¡´ 6ê°œ ì¡°í•©
                allCombinations = [
                    'A > B > C',
                    'A > C > B',
                    'B > A > C',
                    'B > C > A',
                    'C > A > B',
                    'C > B > A'
                ];
            }

            // 5ê°œë§Œ ì„ íƒ (ì •ë‹µì€ ë°˜ë“œì‹œ í¬í•¨)
            let selectedCombinations = [];
            
            if (isMultipleAnswer) {
                // ë³µìˆ˜ ì •ë‹µì¸ ê²½ìš° ëª¨ë“  ì •ë‹µ ì¡°í•© ì¶”ê°€
                selectedCombinations = allCombinations.slice(0, Math.min(correctAnswers.length, 5));
            } else {
                // ë‹¨ì¼ ì •ë‹µì¸ ê²½ìš°
                const correctAnswer = createAnswerString(sorted);
                const correctIndex = allCombinations.indexOf(correctAnswer);
                if (correctIndex !== -1) {
                    selectedCombinations.push(correctAnswer);
                    const remaining = allCombinations.filter((_, index) => index !== correctIndex);
                    const shuffled = remaining.sort(() => Math.random() - 0.5);
                    selectedCombinations = selectedCombinations.concat(shuffled.slice(0, 4));
                }
            }
            
            // ë‚˜ë¨¸ì§€ ì„ ì§€ ì¶”ê°€ (5ê°œê°€ ì•ˆë˜ë©´)
            if (selectedCombinations.length < 5) {
                const basicCombos = [
                    'A > B > C',
                    'A > C > B',
                    'B > A > C',
                    'B > C > A',
                    'C > A > B',
                    'C > B > A'
                ];
                const remaining = basicCombos.filter(combo => !selectedCombinations.includes(combo));
                const shuffled = remaining.sort(() => Math.random() - 0.5);
                selectedCombinations = selectedCombinations.concat(shuffled.slice(0, 5 - selectedCombinations.length));
            }
            
            // 5ê°œë¥¼ ëœë¤í•˜ê²Œ ì„ê¸°
            selectedCombinations.sort(() => Math.random() - 0.5);

            const optionNumbers = ['â‘ ', 'â‘¡', 'â‘¢', 'â‘£', 'â‘¤'];
            const optionsHTML = selectedCombinations.slice(0, 5).map((combo, index) => `
                <div class="option" onclick="selectOption('${combo}')">
                    <span class="option-number">${optionNumbers[index]}</span>
                    <span>${combo}</span>
                </div>
            `).join('');

            document.getElementById('options').innerHTML = optionsHTML;
        }

        function selectOption(answer) {
            if (answered) return;

            const clickedOption = event.currentTarget;
            
            // ë³µìˆ˜ ì •ë‹µì¸ ê²½ìš°
            if (currentProblem.isMultipleAnswer) {
                // ì´ë¯¸ ì„ íƒëœ ì„ ì§€ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì„ íƒ ì·¨ì†Œ
                if (clickedOption.classList.contains('selected')) {
                    clickedOption.classList.remove('selected');
                    selectedAnswers = selectedAnswers.filter(a => a !== answer);
                } else {
                    // ìƒˆë¡œìš´ ì„ ì§€ ì„ íƒ
                    clickedOption.classList.add('selected');
                    selectedAnswers.push(answer);
                }
            } else {
                // ë‹¨ì¼ ì •ë‹µì¸ ê²½ìš°
                // ì´ë¯¸ ì„ íƒëœ ì„ ì§€ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì„ íƒ ì·¨ì†Œ
                if (clickedOption.classList.contains('selected')) {
                    clickedOption.classList.remove('selected');
                    selectedAnswers = [];
                    return;
                }

                // ë‹¤ë¥¸ ì„ ì§€ ì„ íƒ
                document.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('selected');
                });

                clickedOption.classList.add('selected');
                selectedAnswers = [answer];
            }
        }

        function checkAnswer() {
            if (answered) return;
            if (selectedAnswers.length === 0) {
                alert('ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            answered = true;
            
            // ì •ë‹µ ë¬¸ìì—´ ìƒì„± í•¨ìˆ˜
            function createAnswerString(sortedValues) {
                let result = sortedValues[0].name;
                for (let i = 1; i < sortedValues.length; i++) {
                    if (Math.abs(sortedValues[i].value - sortedValues[i-1].value) < 0.01) {
                        result += ' = ' + sortedValues[i].name;
                    } else {
                        result += ' > ' + sortedValues[i].name;
                    }
                }
                return result;
            }
            
            const correctAnswerString = createAnswerString(currentProblem.sorted);
            
            // ì •ë‹µ í™•ì¸
            let isCorrect = false;
            if (currentProblem.isMultipleAnswer) {
                // ë³µìˆ˜ ì •ë‹µ: ì„ íƒí•œ ë‹µ ì¤‘ í•˜ë‚˜ë¼ë„ ì •ë‹µ í˜•íƒœì¸ì§€ í™•ì¸
                isCorrect = selectedAnswers.some(answer => {
                    // ë“±í˜¸ê°€ í¬í•¨ë˜ì–´ ìˆê³ , ëª¨ë“  ì •ë‹µ ë°œì „ì†Œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                    if (!answer.includes('=')) return false;
                    
                    // ì„ íƒí•œ ë‹µì— ëª¨ë“  ì •ë‹µ ë°œì „ì†Œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                    const hasAllCorrect = currentProblem.correctAnswers.every(ca => answer.includes(ca));
                    
                    // ë“±í˜¸ë¡œ ì—°ê²°ëœ ë°œì „ì†Œë“¤ë§Œ ì¶”ì¶œ
                    const parts = answer.split(/\s*>\s*/); // '>' ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
                    for (const part of parts) {
                        const equalParts = part.split(/\s*=\s*/); // '=' ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
                        // ë“±í˜¸ë¡œ ì—°ê²°ëœ ë¶€ë¶„ì— ëª¨ë“  ì •ë‹µ ë°œì „ì†Œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                        if (equalParts.length === currentProblem.correctAnswers.length) {
                            const allMatch = currentProblem.correctAnswers.every(ca => equalParts.includes(ca));
                            if (allMatch) return true;
                        }
                    }
                    
                    return false;
                });
            } else {
                // ë‹¨ì¼ ì •ë‹µ
                if (selectedAnswers.length === 1) {
                    isCorrect = selectedAnswers[0] === correctAnswerString;
                }
            }

            // ì„ ì§€ ìƒ‰ìƒ í‘œì‹œ
            document.querySelectorAll('.option').forEach(opt => {
                const optionText = opt.querySelector('span:last-child').textContent;
                
                if (currentProblem.isMultipleAnswer) {
                    // ë³µìˆ˜ ì •ë‹µì¸ ê²½ìš°: ë“±í˜¸ê°€ í¬í•¨ë˜ê³  ì •ë‹µ ë°œì „ì†Œë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ì—°ê²°ëœ ì„ ì§€
                    const hasEqual = optionText.includes('=');
                    
                    if (hasEqual) {
                        // ë“±í˜¸ë¡œ ì—°ê²°ëœ ë¶€ë¶„ í™•ì¸
                        const parts = optionText.split(/\s*>\s*/);
                        let isCorrectOption = false;
                        
                        for (const part of parts) {
                            const equalParts = part.split(/\s*=\s*/);
                            if (equalParts.length === currentProblem.correctAnswers.length) {
                                const allMatch = currentProblem.correctAnswers.every(ca => equalParts.includes(ca));
                                if (allMatch) {
                                    isCorrectOption = true;
                                    break;
                                }
                            }
                        }
                        
                        if (isCorrectOption) {
                            opt.classList.add('correct');
                        } else if (selectedAnswers.includes(optionText)) {
                            opt.classList.add('wrong');
                        }
                    } else if (selectedAnswers.includes(optionText)) {
                        opt.classList.add('wrong');
                    }
                } else {
                    // ë‹¨ì¼ ì •ë‹µì¸ ê²½ìš°
                    if (optionText === correctAnswerString) {
                        opt.classList.add('correct');
                    } else if (selectedAnswers.includes(optionText) && !isCorrect) {
                        opt.classList.add('wrong');
                    }
                }
                opt.style.cursor = 'default';
            });

            const resultDiv = document.getElementById('result');
            resultDiv.classList.add('show');
            
            if (isCorrect) {
                resultDiv.className = 'result show correct';
                let correctAnswersText = '';
                if (currentProblem.isMultipleAnswer) {
                    correctAnswersText = correctAnswerString + ' (ë™ì¼í•œ íš¨ìœ¨)';
                }
                resultDiv.innerHTML = `
                    âœ“ ì •ë‹µì…ë‹ˆë‹¤!<br>
                    ${currentProblem.isMultipleAnswer ? '<small style="font-size: 14px;">' + correctAnswersText + '</small><br>' : ''}
                    <small style="font-size: 14px; margin-top: 10px; display: block;">
                    íš¨ìœ¨: A = ${currentProblem.effA.toFixed(1)}%, 
                    B = ${currentProblem.effB.toFixed(1)}%, 
                    C = ${currentProblem.effC.toFixed(1)}%
                    </small>
                `;
            } else {
                // ë¶€ë¶„ ì •ë‹µ í™•ì¸ (ë³µìˆ˜ ì •ë‹µì¸ ê²½ìš°)
                let partialCorrect = false;
                if (currentProblem.isMultipleAnswer && selectedAnswers.length > 0) {
                    partialCorrect = selectedAnswers.some(answer => {
                        if (!answer.includes('=')) return false;
                        const parts = answer.split(/\s*>\s*/);
                        for (const part of parts) {
                            const equalParts = part.split(/\s*=\s*/);
                            if (equalParts.length === currentProblem.correctAnswers.length) {
                                const allMatch = currentProblem.correctAnswers.every(ca => equalParts.includes(ca));
                                if (allMatch) return true;
                            }
                        }
                        return false;
                    });
                }
                
                // í•´ì„¤ ìƒì„±
                const explanation = generateExplanation();
                
                resultDiv.className = 'result show wrong';
                
                if (partialCorrect && currentProblem.isMultipleAnswer) {
                    // ë¶€ë¶„ ì •ë‹µì¸ ê²½ìš°
                    resultDiv.className = 'result show partial';
                    resultDiv.innerHTML = `
                        âš ï¸ ë¶€ë¶„ ì •ë‹µì…ë‹ˆë‹¤!<br>
                        <small style="font-size: 14px; margin-top: 5px; display: block;">
                        ì˜¬ë°”ë¥¸ ë‹µì„ ì„ íƒí–ˆì§€ë§Œ, ëª¨ë“  ì •ë‹µì„ ì„ íƒí•´ì•¼ ë§Œì ì…ë‹ˆë‹¤.
                        </small><br>
                        ì •ë‹µ: ${correctAnswerString}<br>
                        <small style="font-size: 14px; margin-top: 10px; display: block;">
                        íš¨ìœ¨: A = ${currentProblem.effA.toFixed(1)}%, 
                        B = ${currentProblem.effB.toFixed(1)}%, 
                        C = ${currentProblem.effC.toFixed(1)}%
                        </small>
                        ${explanation}
                    `;
                } else {
                    // ì™„ì „ ì˜¤ë‹µì¸ ê²½ìš°
                    resultDiv.innerHTML = `
                        âœ— í‹€ë ¸ìŠµë‹ˆë‹¤.<br>
                        ì •ë‹µ: ${correctAnswerString}<br>
                        <small style="font-size: 14px; margin-top: 10px; display: block;">
                        íš¨ìœ¨: A = ${currentProblem.effA.toFixed(1)}%, 
                        B = ${currentProblem.effB.toFixed(1)}%, 
                        C = ${currentProblem.effC.toFixed(1)}%
                        </small>
                        ${explanation}
                    `;
                }
            }
        }

        function generateExplanation() {
            const sorted = currentProblem.sorted;
            
            let explanation = `<div class="explanation">
                <div class="explanation-title">ğŸ“ ë¬¸ì œ í’€ì´</div>`;
            
            explanation += `<div class="explanation-step">
                <strong>1ë‹¨ê³„: ê° ë°œì „ì†Œì˜ íš¨ìœ¨ ê³„ì‚°</strong><br>
                íš¨ìœ¨ = (ìƒì‚°ëœ ì „ê¸° ì—ë„ˆì§€ / ê³µê¸‰ëœ ì—ë„ˆì§€) Ã— 100%
            </div>`;
            
            explanation += `<div class="explanation-step">
                â€¢ A ë°œì „ì†Œ: ${currentProblem.outputA} MJ Ã· ${currentProblem.inputA} MJ Ã— 100% = <strong>${currentProblem.effA.toFixed(1)}%</strong><br>
                â€¢ B ë°œì „ì†Œ: ${currentProblem.outputB} kJ Ã· ${currentProblem.inputB} kJ Ã— 100% = <strong>${currentProblem.effB.toFixed(1)}%</strong><br>
                â€¢ C ë°œì „ì†Œ: ${currentProblem.outputC} MJ Ã· ${currentProblem.inputC} MJ Ã— 100% = <strong>${currentProblem.effC.toFixed(1)}%</strong>
            </div>`;
            
            explanation += `<div class="explanation-step">
                <strong>2ë‹¨ê³„: íš¨ìœ¨ ë¹„êµ</strong><br>
                íš¨ìœ¨ì´ ë†’ì„ìˆ˜ë¡ ê°™ì€ ì—ë„ˆì§€ë¡œ ë” ë§ì€ ì „ê¸°ë¥¼ ìƒì‚°í•©ë‹ˆë‹¤.
            </div>`;
            
            // ì •ë‹µ ë¬¸ìì—´ ìƒì„±
            let answerString = sorted[0].name;
            for (let i = 1; i < sorted.length; i++) {
                if (Math.abs(sorted[i].value - sorted[i-1].value) < 0.01) {
                    answerString += ' = ' + sorted[i].name;
                } else {
                    answerString += ' > ' + sorted[i].name;
                }
            }
            
            if (currentProblem.isMultipleAnswer) {
                explanation += `<div class="explanation-step">
                    <strong style="color: #d63384;">âš ï¸ ë³µìˆ˜ ì •ë‹µ</strong><br>
                    ${currentProblem.correctAnswers.join(', ')}ì˜ íš¨ìœ¨ì´ <strong>${sorted[0].value.toFixed(1)}%ë¡œ ë™ì¼</strong>í•˜ë¯€ë¡œ,<br>
                    ë“±í˜¸(=)ë¥¼ ì‚¬ìš©í•˜ì—¬ í‘œí˜„í•©ë‹ˆë‹¤.
                </div>`;
                
                explanation += `<div class="explanation-step">
                    ${answerString}
                </div>`;
            } else {
                explanation += `<div class="explanation-step">
                    ${answerString}
                </div>`;
            }
            
            explanation += `<div class="explanation-step" style="margin-top: 10px;">
                <strong>âˆ´ ì •ë‹µ: ${answerString}</strong>
            </div>`;
            
            explanation += `</div>`;
            
            return explanation;
        }

        function resetAnswer() {
            selectedAnswers = [];
            answered = false;
            document.getElementById('result').classList.remove('show');
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'wrong');
                opt.style.cursor = 'pointer';
            });
        }

        // ì´ˆê¸° ë¬¸ì œ ìƒì„±
        generateNewProblem();
    </script>
</body>
</html>